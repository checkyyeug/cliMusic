# MCP Tools Specification

**Version**: 1.0.0
**Protocol**: JSON-RPC 2.0 over stdio

---

## Overview

XPU exposes all CLI functionality as MCP (Model Context Protocol) tools for AI agents like Claude. These tools enable natural language control of music playback.

---

## Tool Categories

1. **Playback Control**: Play, pause, resume, stop, seek
2. **Queue Management**: Add, list, remove, clear, next, previous
3. **Metadata**: Get track metadata, search
4. **Audio Processing**: Volume, EQ

---

## Tool Definitions

### Playback Control

#### xpu_play

Start audio playback.

```yaml
name: xpu_play
description: Start playing audio from the current queue or a specific file
parameters:
  type: object
  properties:
    file_path:
      type: string
      description: Absolute path to audio file (optional)
    position:
      type: number
      description: Start position in seconds (optional)
```

**Response**:
```json
{
  "success": true,
  "state": "playing",
  "current_track": { /* Track object */ },
  "position": 0.0
}
```

---

#### xpu_pause

Pause current playback.

```yaml
name: xpu_pause
description: Pause the currently playing audio
parameters:
  type: object
  properties: {}
```

**Response**:
```json
{
  "success": true,
  "state": "paused",
  "position": 45.2
}
```

---

#### xpu_resume

Resume paused playback.

```yaml
name: xpu_resume
description: Resume paused audio playback
parameters:
  type: object
  properties: {}
```

**Response**:
```json
{
  "success": true,
  "state": "playing",
  "position": 45.2
}
```

---

#### xpu_stop

Stop playback and reset position.

```yaml
name: xpu_stop
description: Stop audio playback and reset to beginning
parameters:
  type: object
  properties: {}
```

**Response**:
```json
{
  "success": true,
  "state": "stopped",
  "position": 0.0
}
```

---

#### xpu_seek

Seek to a specific position.

```yaml
name: xpu_seek
description: Seek to a specific position in the current track
parameters:
  type: object
  required: [position]
  properties:
    position:
      type: number
      description: Position in seconds
```

**Response**:
```json
{
  "success": true,
  "state": "playing",
  "position": 60.0
}
```

---

### Queue Management

#### xpu_queue_add

Add a track to the queue.

```yaml
name: xpu_queue_add
description: Add a track to the playback queue
parameters:
  type: object
  required: [file_path]
  properties:
    file_path:
      type: string
      description: Absolute path to audio file
    position:
      type: integer
      description: Insert at specific position (optional, appends if not specified)
```

**Response**:
```json
{
  "success": true,
  "queue": { /* Queue object */ },
  "added_at": 5
}
```

---

#### xpu_queue_list

List current queue contents.

```yaml
name: xpu_queue_list
description: Get the current playback queue
parameters:
  type: object
  properties:
    include_history:
      type: boolean
      description: Include previously played tracks (optional)
```

**Response**:
```json
{
  "success": true,
  "queue": {
    "queue_id": "uuid",
    "tracks": [ /* Track objects */ ],
    "current_index": 2
  }
}
```

---

#### xpu_queue_remove

Remove a track from the queue.

```yaml
name: xpu_queue_remove
description: Remove a track from the playback queue
parameters:
  type: object
  required: [index]
  properties:
    index:
      type: integer
      description: Index of track to remove
```

**Response**:
```json
{
  "success": true,
  "queue": { /* Queue object */ }
}
```

---

#### xpu_queue_clear

Clear all tracks from the queue.

```yaml
name: xpu_queue_clear
description: Remove all tracks from the playback queue
parameters:
  type: object
  properties: {}
```

**Response**:
```json
{
  "success": true,
  "queue": {
    "tracks": [],
    "current_index": -1
  }
}
```

---

#### xpu_queue_next

Skip to the next track.

```yaml
name: xpu_queue_next
description: Skip to the next track in the queue
parameters:
  type: object
  properties: {}
```

**Response**:
```json
{
  "success": true,
  "current_track": { /* Track object */ },
  "position": 0.0
}
```

---

#### xpu_queue_previous

Go to the previous track.

```yaml
name: xpu_queue_previous
description: Go to the previous track in the queue
parameters:
  type: object
  properties: {}
```

**Response**:
```json
{
  "success": true,
  "current_track": { /* Track object */ },
  "position": 0.0
}
```

---

### Metadata

#### xpu_meta_get

Get metadata for a track.

```yaml
name: xpu_meta_get
description: Get metadata for an audio file
parameters:
  type: object
  required: [file_path]
  properties:
    file_path:
      type: string
      description: Absolute path to audio file
```

**Response**:
```json
{
  "success": true,
  "track": { /* Track object */ }
}
```

---

#### xpu_meta_search

Search for tracks by metadata.

```yaml
name: xpu_meta_search
description: Search for tracks by title, artist, album, or other metadata
parameters:
  type: object
  required: [query]
  properties:
    query:
      type: string
      description: Search query
    field:
      type: string
      enum: [all, title, artist, album]
      description: Field to search (optional, default: all)
    limit:
      type: integer
      description: Maximum results (optional, default: 50)
```

**Response**:
```json
{
  "success": true,
  "results": [ /* Track objects */ ],
  "count": 10
}
```

---

### Audio Processing

#### xpu_process_volume

Set volume level.

```yaml
name: xpu_process_volume
description: Set the playback volume level
parameters:
  type: object
  required: [volume]
  properties:
    volume:
      type: number
      minimum: 0.0
      maximum: 1.0
      description: Volume level (0.0 = silent, 1.0 = full)
```

**Response**:
```json
{
  "success": true,
  "volume": 0.8
}
```

---

#### xpu_process_eq

Set equalizer preset.

```yaml
name: xpu_process_eq
description: Set the equalizer preset
parameters:
  type: object
  required: [preset]
  properties:
    preset:
      type: string
      enum: [flat, rock, pop, classical, jazz]
      description: EQ preset name
```

**Response**:
```json
{
  "success": true,
  "preset": "rock",
  "bands": [
    {"frequency": 60, "gain_db": 3},
    {"frequency": 250, "gain_db": 1},
    {"frequency": 1000, "gain_db": 0},
    {"frequency": 4000, "gain_db": 2},
    {"frequency": 16000, "gain_db": 3}
  ]
}
```

---

#### xpu_process_mute

Mute or unmute audio.

```yaml
name: xpu_process_mute
description: Mute or unmute audio playback
parameters:
  type: object
  required: [muted]
  properties:
    muted:
      type: boolean
      description: True to mute, false to unmute
```

**Response**:
```json
{
  "success": true,
  "muted": true
}
```

---

## Error Handling

All tools return errors in standard JSON-RPC 2.0 format:

```json
{
  "jsonrpc": "2.0",
  "id": "request-id",
  "error": {
    "code": -32000,
    "message": "File not found",
    "data": {
      "file_path": "/path/to/file.flac"
    }
  }
}
```

### Error Codes

| Code | Name | Description |
|------|------|-------------|
| -32700 | Parse error | Invalid JSON |
| -32600 | Invalid Request | Invalid JSON-RPC request |
| -32601 | Method not found | Tool does not exist |
| -32602 | Invalid params | Invalid parameters |
| -32000 | Server error | Uncategorized error |
| 1004 | File not found | |
| 1007 | Audio device error | |
| 1008 | Queue empty | |

---

## Example Conversations

### Example 1: Play a song

```
User: "Play my favorite song"

Claude's reasoning:
- Need to find user's favorite song
- Call xpu_meta_search with query="favorite"
- Get file path from results
- Call xpu_play with file_path

Claude calls:
1. xpu_meta_search(query="favorite", field="all")
2. xpu_play(file_path="/path/to/result.flac")

Response: "Now playing: Favorite Song by Artist"
```

### Example 2: Create a playlist

```
User: "Make a rock playlist"

Claude's reasoning:
- Search for rock tracks
- Add them to queue
- Start playback

Claude calls:
1. xpu_meta_search(query="rock", field="all")
2. For each result: xpu_queue_add(file_path=...)
3. xpu_play()

Response: "Created rock playlist with 15 tracks. Now playing."
```

### Example 3: Adjust audio

```
User: "Turn up the bass"

Claude's reasoning:
- "Bass" means need EQ with boosted low frequencies
- Rock preset has boosted 60Hz and 250Hz
- Call xpu_process_eq with rock preset

Claude calls:
1. xpu_process_eq(preset="rock")

Response: "Applied rock EQ preset with boosted bass."
```

---

## Claude Skills Integration

### Skill Definition

```yaml
name: XPU Music Control
description: Control music playback using XPU
tools:
  - xpu_play
  - xpu_pause
  - xpu_resume
  - xpu_stop
  - xpu_seek
  - xpu_queue_add
  - xpu_queue_list
  - xpu_queue_remove
  - xpu_queue_clear
  - xpu_queue_next
  - xpu_queue_previous
  - xpu_meta_get
  - xpu_meta_search
  - xpu_process_volume
  - xpu_process_eq
  - xpu_process_mute
```

### Usage Example

```python
# In Claude Code
from claude_skills import skill

@skill
def play_music(query: str):
    """Search for and play music"""
    results = xpu_meta_search(query)
    if results["count"] > 0:
        track = results["results"][0]
        xpu_play(track["file_path"])
        return f"Now playing: {track['title']}"
    return "No results found"
```

---

## Rate Limiting

MVP has no rate limiting (local single-user).

Future versions:
- Token bucket algorithm
- Per-client limits
- Priority queues for AI agents

---

## Security

MVP: Local stdio only (no network exposure)

Future versions:
- MCP over WebSocket with TLS
- API key authentication
- Request signing
